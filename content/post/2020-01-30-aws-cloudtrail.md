---
title: "AWS CloudTrail"
date: "2020-01-30T14:15:06-05:00"
url: "/posts/aws-cloudtrail"
draft: false
categories:
- infosec
tags:
- cloud
- aws
- monitoring
- secops
- cloudtrail
summary: "AWS CloudTrail is the cornerstone of cloud SECOPS"
---

Previously, [I alluded to]({{% relref
"/post/2020-01-17-changing-direction.md" %}}) a change in my professional
direction.  I'm now focused on managing security operations in the cloud. To
that end, I'm
going to write a series of posts on the atomic pieces of what a cloud security
operations portfolio looks like. As I live in the AWS cloud, these posts will
focus on various AWS services. However, the security operations posts
that deal more with theory or philosophy should apply to Azure, GCP, or other
cloud environments.

This post covers [AWS CloudTrail](https://aws.amazon.com/cloudtrail/)

## What is CloudTrail?

I like to think of CloudTrail as [Syslog](https://en.wikipedia.org/wiki/Syslog)
for the AWS cloud: when enabled, it logs all AWS API events to an S3 bucket.

CloudTrail, therefore, gives you the ability to log every action taken in your
AWS account. This is necessary for governance, compliance, auditing, and
investigation. CloudTrail underpins nearly all of AWS's security services,
and most third-party security tools I'm aware of leverage CloudTrail to provide value.

All actions that users, accounts, services, or other entities - principals in
AWS parlance - perform in AWS are mapped to AWS API calls. Check out the [AWS
Documentation](https://docs.aws.amazon.com/index.html), or play around with
[AWS CLI](https://aws.amazon.com/cloudtrail/) for more information on all API
calls.

### Management vs Data Events

There is a difference between the events generated by management (or _control
plane_) activities - think the creation of resources within your account -
versus the events generated on or within the resource itself (or _data plane_).

I like to keep the distinction in my head by thinking of the creation of an S3
bucket as a _control plane_ operation while any activities that get, put, or
list an object in that bucket would be _data plane_ operations. These generate
_Management_ and _Data_ events, respectively.

## How Do I Enable CloudTrail?

Enabling CloudTrail is easy - it's enabled when you create your AWS account.
Open the [CloudTrail Console](https://console.aws.amazon.com/cloudtrail/) and
select _Event History_ to view the most recent events. This view will, by
default, hide read-only events, so if nothing is displayed, simply remove the
filter at the top of the events list.

## Storing CloudTrail Events Long-Term

CloudTrail is _gratis_ for viewing and downloading the trailing 90 days of
account activity. This might be fine for your use case. If you need long-term
storage to support GRC, auditing, and investigation capabilities, it is possible
to create a _trail_ that will deliver management events to an S3 bucket.

You can then use a log analytics tool or [CloudTrail
Insights](https://aws.amazon.com/about-aws/whats-new/2019/11/aws-cloudtrail-announces-cloudtrail-insights/)
to analyze your logs as you see fit. More to come on this.

It is also important to note that enabling a _trail_ will feed all CloudTrail
events from all regions in your account into the _trail_'s S3 bucket. Without
enabling a _trail_ to deliver this regional data, you would have to investigate
the _Event History_ for each region in your account!

## Conclusion

This was hopefully a useful CloudTrail primer. More to come on the topic of
querying CloudTrail _trails_ to find evidence of activity within an account or
accounts.
